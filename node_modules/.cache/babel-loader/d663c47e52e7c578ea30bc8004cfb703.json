{"ast":null,"code":"import _classCallCheck from\"F:\\\\Documents\\\\webvisualisointi\\\\jkl-guide\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"F:\\\\Documents\\\\webvisualisointi\\\\jkl-guide\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"F:\\\\Documents\\\\webvisualisointi\\\\jkl-guide\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"F:\\\\Documents\\\\webvisualisointi\\\\jkl-guide\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"F:\\\\Documents\\\\webvisualisointi\\\\jkl-guide\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"F:\\\\Documents\\\\webvisualisointi\\\\jkl-guide\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import'bootstrap/dist/css/bootstrap.min.css';import'bootstrap/dist/css/bootstrap.css';import'bootstrap';import*as $ from'jquery';import React from'react';import'../site.scss';import mapboxgl from'mapbox-gl';import'mapbox-gl/dist/mapbox-gl.css';var searchIcon=React.createElement(\"svg\",{version:\"1.1\",xmlns:\"http://www.w3.org/2000/svg\",shapeRendering:\"geometricPrecision\",viewBox:\"0 0 512 512\",xlink:\"http://www.w3.org/1999/xlink\",enableBackground:\"new 0 0 512 512\"},React.createElement(\"g\",null,React.createElement(\"path\",{d:\"M495,466.2L377.2,348.4c29.2-35.6,46.8-81.2,46.8-130.9C424,103.5,331.5,11,217.5,11C103.4,11,11,103.5,11,217.5   S103.4,424,217.5,424c49.7,0,95.2-17.5,130.8-46.7L466.1,495c8,8,20.9,8,28.9,0C503,487.1,503,474.1,495,466.2z M217.5,382.9   C126.2,382.9,52,308.7,52,217.5S126.2,52,217.5,52C308.7,52,383,126.3,383,217.5S308.7,382.9,217.5,382.9z\"})));var mapApp=/*#__PURE__*/function(_React$Component){_inherits(mapApp,_React$Component);function mapApp(props){var _this;_classCallCheck(this,mapApp);_this=_possibleConstructorReturn(this,_getPrototypeOf(mapApp).call(this,props));_this.handleonChange=function(e){var value=e.target.value;var expression=new RegExp(\"\".concat(value),'i');var url=\"http://m3311.pages.labranet.jamk.fi/web-visualisointi/map.json\";if(_this.state.tag===true)_this.setState({tag:false});if(value.length>0&&e.keyCode!==40&&e.keyCode!==38){var names=[];var address=[];var lng=[];var lat=[];$.ajax({url:url,success:function success(searchResults){console.log(\"AJAX success\");var services=searchResults.features;services.forEach(function(element){var name=element.properties.name;var addr=element.properties.address;var long=element.geometry.coordinates[0];var latt=element.geometry.coordinates[1];if(expression.test(name)){names.push(name);address.push(addr);lng.push(long);lat.push(latt);}});_this.setState({results:{name:names,address:address,lng:lng,lat:lat}});},error:function error(xhr,status,err){console.log(\"Failed to fetch data\");}});};_this.setState(function(){return{results:{name:[],address:[],lng:[],lat:[]},searchvalue:value};});};_this.state={lng:25.7466,lat:62.2373,zoom:10.42,searchvalue:\"\",results:{name:[],address:[],lng:[],lat:[]},tag:true};_this.componentDidMount=_this.componentDidMount.bind(_assertThisInitialized(_this));_this.handleonChange=_this.handleonChange.bind(_assertThisInitialized(_this));_this.renderResults=_this.renderResults.bind(_assertThisInitialized(_this));_this.resultSelected=_this.resultSelected.bind(_assertThisInitialized(_this));_this.handleSubmit=_this.handleSubmit.bind(_assertThisInitialized(_this));_this.handleonKeyDown=_this.handleonKeyDown.bind(_assertThisInitialized(_this));return _this;}_createClass(mapApp,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;mapboxgl.accessToken='pk.eyJ1IjoicHVua2thcmlkdWRlIiwiYSI6ImNrMjM2aGl2NTB0OHIzY25yb29oOXNlbmYifQ.-jVIXdpV1emEldkSzf-Q5g';this.map1=new mapboxgl.Map({container:this.mapContainer,style:'mapbox://styles/mapbox/streets-v11',center:[this.state.lng,this.state.lat],zoom:this.state.zoom});this.map1.on('move',function(){_this2.setState({lng:_this2.map1.getCenter().lng.toFixed(4),lat:_this2.map1.getCenter().lat.toFixed(4),zoom:_this2.map1.getZoom().toFixed(2)});});this.map1.on('load',function(){_this2.map1.getCanvasContainer();_this2.map1.getCanvas();});}},{key:\"handleonKeyDown\",value:function handleonKeyDown(e){var active=document.activeElement;if(e.keyCode===40&&active.nextSibling){///console.log(\"alas\");\nactive.nextSibling.focus();}else if(e.keyCode===38&&active.previousSibling){///console.log(\"ylös\");\nactive.previousSibling.focus();}else if(e.keyCode===38&&!active.previousSibling){///console.log(\"ylös ja focus\");\nthis.refs.searchInput.focus();}else if(e.keyCode===13){///console.log(\"enter\");\ne.preventDefault();this.resultSelected(active.textContent);}}},{key:\"handleSubmit\",value:function handleSubmit(e){e.preventDefault();$('.marker').remove();$('.mapboxgl-popup').remove();if(this.refs.searchInput.value!==null){this.addMarkers();this.setState(function(){return{results:{name:[],address:[],lng:[],lat:[]},searchvalue:'',tag:false};});}this.refs.searchInput.focus();///console.log(\"submit\");\n///console.log(this.state.results.name)\n///console.log(this.state.results.address)\n///console.log(this.state.results.lng)\n///console.log(this.state.results.lat)\n}},{key:\"resultSelected\",value:function resultSelected(value){var _this3=this;var index=this.state.results.name.indexOf(value);this.setState(function(){return{searchvalue:value,results:{name:[value],address:[_this3.state.results.address[index]],lng:[_this3.state.results.lng[index]],lat:[_this3.state.results.lat[index]]},tag:true};});this.refs.searchInput.focus();}},{key:\"addMarkers\",value:function addMarkers(){var _this4=this;var results=this.state.results;results.name.forEach(function(item,index){///console.log(index)\nvar el=document.createElement('div');el.className='marker';var marker=new mapboxgl.Marker(el).setLngLat([results.lng[index],results.lat[index]]).setPopup(new mapboxgl.Popup({offset:25})// add popups\n.setHTML('<h1>'+results.name[index]+'</h1><p>'+results.address[index]+'</p>')).addTo(_this4.map1);});}},{key:\"renderResults\",value:function renderResults(){var _this5=this;var results=this.state.results;///console.log(\"results\" + results.name);\nif(results.name.length===0||this.state.tag===true){return null;}return React.createElement(\"ul\",{tabIndex:\"0\",id:\"asyncUl\",className:\"shadow\",onKeyDown:this.handleonKeyDown},results.name.map(function(item,key){return React.createElement(\"li\",{tabIndex:\"0\",key:\"ln\"+key,onClick:function onClick(){return _this5.resultSelected(item);}},item);}));}},{key:\"render\",value:function render(){var _this6=this;var searchvalue=this.state.searchvalue;return React.createElement(\"div\",{id:\"mapappWrapper\",className:\"d-flex flex-column justify-content-between\"},React.createElement(\"form\",{onSubmit:this.handleSubmit,className:\"\"},React.createElement(\"div\",{id:\"searchForm\",className:\"d-flex flex-wrap px-0\"},React.createElement(\"div\",{id:\"searchInput\",className:\"col-sm-10 px-0\"},React.createElement(\"input\",{className:\" form-control form-control-lg shadow\",type:\"text\",placeholder:\"Service name, category or related word\",onChange:this.handleonChange,onKeyDown:function onKeyDown(e){var nextFocus=$(\"#asyncresult ul li\");if(e.keyCode===40&&$(\"#asyncresult\").children().length>0){_this6.refs.searchInput.blur();nextFocus.first().focus();}},value:searchvalue,ref:\"searchInput\"})),React.createElement(\"div\",{id:\"searchBtn\",className:\"col-sm-2 px-0\"},React.createElement(\"button\",{className:\"form-control form-control-lg shadow\",type:\"submit\"},searchIcon)),React.createElement(\"div\",{id:\"asyncresult\",className:\"col-sm-10 px-0\"},this.renderResults()))),React.createElement(\"div\",{id:\"mapParent\",className:\"container-fluid px-0 rounded shadow mt-md-2 mt-0\"},React.createElement(\"div\",{className:\"sidebarStyle\"},React.createElement(\"div\",null,\"Longitude: \",this.state.lng,\" | Latitude: \",this.state.lat,\" | Zoom: \",this.state.zoom)),React.createElement(\"div\",{ref:function ref(el){return _this6.mapContainer=el;},className:\"mapContainer\"})));}}]);return mapApp;}(React.Component);;export default mapApp;","map":{"version":3,"sources":["F:/Documents/webvisualisointi/jkl-guide/src/component/mapapp.js"],"names":["$","React","mapboxgl","searchIcon","mapApp","props","handleonChange","e","value","target","expression","RegExp","url","state","tag","setState","length","keyCode","names","address","lng","lat","ajax","success","searchResults","console","log","services","features","forEach","element","name","properties","addr","long","geometry","coordinates","latt","test","push","results","error","xhr","status","err","searchvalue","zoom","componentDidMount","bind","renderResults","resultSelected","handleSubmit","handleonKeyDown","accessToken","map1","Map","container","mapContainer","style","center","on","getCenter","toFixed","getZoom","getCanvasContainer","getCanvas","active","document","activeElement","nextSibling","focus","previousSibling","refs","searchInput","preventDefault","textContent","remove","addMarkers","index","indexOf","item","el","createElement","className","marker","Marker","setLngLat","setPopup","Popup","offset","setHTML","addTo","map","key","nextFocus","children","blur","first","Component"],"mappings":"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","sourcesContent":["import 'bootstrap/dist/css/bootstrap.min.css';\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport 'bootstrap';\r\nimport * as $ from 'jquery';\r\nimport React from 'react';\r\nimport '../site.scss';\r\nimport mapboxgl from 'mapbox-gl';\r\nimport 'mapbox-gl/dist/mapbox-gl.css';\r\n\r\nconst searchIcon =\r\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" shapeRendering=\"geometricPrecision\" viewBox=\"0 0 512 512\" xlink=\"http://www.w3.org/1999/xlink\" enableBackground=\"new 0 0 512 512\">\r\n<g>\r\n<path d=\"M495,466.2L377.2,348.4c29.2-35.6,46.8-81.2,46.8-130.9C424,103.5,331.5,11,217.5,11C103.4,11,11,103.5,11,217.5   S103.4,424,217.5,424c49.7,0,95.2-17.5,130.8-46.7L466.1,495c8,8,20.9,8,28.9,0C503,487.1,503,474.1,495,466.2z M217.5,382.9   C126.2,382.9,52,308.7,52,217.5S126.2,52,217.5,52C308.7,52,383,126.3,383,217.5S308.7,382.9,217.5,382.9z\"/>\r\n</g>\r\n</svg>;\r\n\r\nclass mapApp extends React.Component {\r\n    \r\n    constructor(props) {\r\n        super(props);\r\n        \r\n        this.state = {\r\n        lng: 25.7466,\r\n        lat: 62.2373,\r\n        zoom: 10.42,\r\n        searchvalue: \"\",\r\n        results: {\r\n            name: [],\r\n            address: [],\r\n            lng: [],\r\n            lat: [],\r\n        },\r\n         tag: true\r\n        };\r\n\r\n        this.componentDidMount = this.componentDidMount.bind(this)\r\n        this.handleonChange = this.handleonChange.bind(this);\r\n        this.renderResults = this.renderResults.bind(this);\r\n        this.resultSelected = this.resultSelected.bind(this);\r\n        this.handleSubmit = this.handleSubmit.bind(this);\r\n        this.handleonKeyDown = this.handleonKeyDown.bind(this);\r\n    }\r\n    \r\n    componentDidMount() {\r\n        mapboxgl.accessToken = 'pk.eyJ1IjoicHVua2thcmlkdWRlIiwiYSI6ImNrMjM2aGl2NTB0OHIzY25yb29oOXNlbmYifQ.-jVIXdpV1emEldkSzf-Q5g';\r\n        this.map1 = new mapboxgl.Map({\r\n            container: this.mapContainer,\r\n            style: 'mapbox://styles/mapbox/streets-v11',\r\n            center: [this.state.lng, this.state.lat],\r\n            zoom: this.state.zoom\r\n        })\r\n\r\n        this.map1.on('move', () => {\r\n            this.setState({\r\n            lng: this.map1.getCenter().lng.toFixed(4),\r\n            lat: this.map1.getCenter().lat.toFixed(4),\r\n            zoom: this.map1.getZoom().toFixed(2)\r\n            })\r\n        })\r\n        this.map1.on('load', () => {\r\n            this.map1.getCanvasContainer();\r\n            this.map1.getCanvas();\r\n        })\r\n    }\r\n\r\n    handleonChange = (e) => {\r\n        const value = e.target.value;\r\n        const expression = new RegExp(`${value}`,'i');\r\n        const url = \"http://m3311.pages.labranet.jamk.fi/web-visualisointi/map.json\";\r\n\r\n        if( this.state.tag === true) this.setState({tag: false});\r\n        if(value.length > 0 && e.keyCode !== 40 && e.keyCode !== 38){\r\n            \r\n            let names = [];\r\n            let address = [];\r\n            let lng = [];\r\n            let lat = [];\r\n            $.ajax({\r\n                url: url,\r\n                success: (searchResults) => {\r\n                    console.log(\"AJAX success\")\r\n                    const services = searchResults.features;\r\n                    services.forEach((element) => {\r\n                        let name = element.properties.name;\r\n                        let addr = element.properties.address;\r\n                        let long = element.geometry.coordinates[0];\r\n                        let latt = element.geometry.coordinates[1];\r\n                        if(expression.test(name)){\r\n                            names.push(name);\r\n                            address.push(addr);\r\n                            lng.push(long);\r\n                            lat.push(latt);\r\n                        }\r\n                    });\r\n                    this.setState({\r\n                        results: {\r\n                            name: names,\r\n                            address: address,\r\n                            lng: lng,\r\n                            lat: lat \r\n                        }\r\n                    });\r\n                },\r\n                error: (xhr, status, err) => {\r\n                    console.log(\"Failed to fetch data\");\r\n                }\r\n            });\r\n        };\r\n        this.setState(() => ({ results: { name: [], address: [], lng: [], lat: []}, searchvalue: value }));  \r\n    }\r\n\r\n    handleonKeyDown(e){\r\n        let active = document.activeElement;\r\n        if(e.keyCode === 40 && active.nextSibling){\r\n            ///console.log(\"alas\");\r\n            active.nextSibling.focus();\r\n        }\r\n        else if(e.keyCode === 38 && active.previousSibling){\r\n            ///console.log(\"ylös\");\r\n            active.previousSibling.focus();\r\n        }\r\n        else if(e.keyCode === 38 && !active.previousSibling){\r\n            ///console.log(\"ylös ja focus\");\r\n            this.refs.searchInput.focus();\r\n        }\r\n        else if(e.keyCode === 13){\r\n            ///console.log(\"enter\");\r\n            e.preventDefault();\r\n            this.resultSelected(active.textContent);\r\n        }\r\n    }\r\n\r\n    handleSubmit(e){\r\n        e.preventDefault();\r\n        $('.marker').remove();\r\n        $('.mapboxgl-popup').remove();\r\n        if(this.refs.searchInput.value !== null){\r\n            this.addMarkers();\r\n            this.setState(() => ({ \r\n                results: { \r\n                    name: [], \r\n                    address: [], \r\n                    lng: [], \r\n                    lat: []\r\n                }, \r\n                searchvalue: '' , \r\n                tag: false\r\n            }));  \r\n        } \r\n        this.refs.searchInput.focus();\r\n        ///console.log(\"submit\");\r\n        ///console.log(this.state.results.name)\r\n        ///console.log(this.state.results.address)\r\n        ///console.log(this.state.results.lng)\r\n        ///console.log(this.state.results.lat)\r\n    }\r\n\r\n    resultSelected (value) {\r\n        let index = this.state.results.name.indexOf(value);\r\n        this.setState(() => ({\r\n            searchvalue: value,\r\n            results: {\r\n                name: [value], \r\n                address: [ this.state.results.address[index]],\r\n                lng: [this.state.results.lng[index]],\r\n                lat: [this.state.results.lat[index]]\r\n            },\r\n            tag: true\r\n        }));\r\n        \r\n        this.refs.searchInput.focus();\r\n    }\r\n\r\n    addMarkers(){\r\n        const { results} = this.state;\r\n        results.name.forEach((item,index) => {\r\n            ///console.log(index)\r\n            let el = document.createElement('div');\r\n            el.className = 'marker';\r\n            let marker = new mapboxgl.Marker(el)\r\n            .setLngLat([results.lng[index], results.lat[index]])\r\n            .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups\r\n            .setHTML('<h1>' + results.name[index] + '</h1><p>' + results.address[index] + '</p>'))\r\n            .addTo(this.map1);\r\n        })\r\n        \r\n       \r\n    }\r\n\r\n    renderResults() {\r\n        const { results } = this.state;\r\n        ///console.log(\"results\" + results.name);\r\n        if (results.name.length === 0 || this.state.tag === true) {\r\n            return null;\r\n        }\r\n        return (\r\n            <ul tabIndex='0' id=\"asyncUl\" className=\"shadow\" onKeyDown={this.handleonKeyDown}>\r\n                {results.name.map((item, key) => \r\n                <li \r\n                    tabIndex='0'\r\n                    key={\"ln\"+key} \r\n                    onClick={() => \r\n                        this.resultSelected(item)\r\n                    }\r\n                    \r\n                    >\r\n                        {item}\r\n                </li>)}\r\n            </ul>\r\n        )\r\n    }\r\n       \r\n    render() {\r\n        const { searchvalue } = this.state;\r\n        return (\r\n            <div id=\"mapappWrapper\" className=\"d-flex flex-column justify-content-between\">\r\n                <form onSubmit={this.handleSubmit} className=\"\">\r\n                    <div id=\"searchForm\" className=\"d-flex flex-wrap px-0\">\r\n                        <div id=\"searchInput\" className=\"col-sm-10 px-0\">\r\n                            <input \r\n                                className=\" form-control form-control-lg shadow\" \r\n                                type=\"text\" \r\n                                placeholder=\"Service name, category or related word\"\r\n                                onChange={this.handleonChange}\r\n                                onKeyDown={(e) => {\r\n                                    let nextFocus = $(\"#asyncresult ul li\");\r\n                                    if(e.keyCode === 40 && $(\"#asyncresult\").children().length > 0){\r\n                                        this.refs.searchInput.blur();\r\n                                        nextFocus.first().focus();\r\n                                        \r\n                                    }\r\n                                }}\r\n                                value={searchvalue}\r\n                                ref=\"searchInput\"\r\n                                />\r\n                        </div>\r\n                        <div id=\"searchBtn\" className=\"col-sm-2 px-0\">\r\n                            <button\r\n                                className=\"form-control form-control-lg shadow\" \r\n                                type=\"submit\">\r\n                                {searchIcon}\r\n                            </button>\r\n                        </div>\r\n                        <div \r\n                            id=\"asyncresult\" \r\n                            className=\"col-sm-10 px-0\"\r\n                            >\r\n                                {this.renderResults()}\r\n                        </div>\r\n                    </div>  \r\n                </form>\r\n                \r\n                <div id=\"mapParent\" className=\"container-fluid px-0 rounded shadow mt-md-2 mt-0\">\r\n                    <div className='sidebarStyle'>\r\n                        <div>Longitude: {this.state.lng} | Latitude: {this.state.lat} | Zoom: {this.state.zoom}</div>\r\n                    </div>\r\n                    <div ref={el => this.mapContainer = el} className=\"mapContainer\" />\r\n                </div>\r\n            </div>       \r\n        )\r\n    }\r\n};\r\n\r\nexport default mapApp;\r\n\r\n"]},"metadata":{},"sourceType":"module"}